<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ATS-Friendly AI Resume Analyzer </title>

<style>
  :root{
    --bg:#0f1724; --accent:#06b6d4; --accent-2:#7c3aed; --muted:#9aa4b2; --glass:rgba(255,255,255,0.04); --glass-2:rgba(255,255,255,0.02);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%, #071022 60%);color:#e6eef6}
  .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;padding:32px}
  .main{width:100%;max-width:1100px;display:grid;grid-template-columns:1fr 420px;gap:20px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  textarea{min-height:130px;background:transparent;border:1px dashed rgba(255,255,255,0.04);padding:12px;border-radius:8px;color:inherit;outline:none}
  input[type=file]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted)}
  .btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;padding:10px 14px;border-radius:10px;color:#071022;font-weight:600;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .small{font-size:13px;color:var(--muted)}
  .breakdown .bar{flex:1;height:12px;background:var(--glass);border-radius:8px;overflow:hidden}
  .bar > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width 900ms ease}
  .suggestions{margin-top:8px;background:var(--glass-2);padding:12px;border-radius:8px;color:var(--muted);font-size:13px}
  @media (max-width:980px){ .main{grid-template-columns:1fr; } }
</style>

<!-- libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
<script>
  // configure PDF.js worker
  if (window.pdfjsLib) {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js';
  }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.17/mammoth.browser.min.js"></script>
</head>
<body>
<div class="wrap">
  <h1>ATS-Friendly AI Resume Analyzer </h1>

  <section class="main" aria-labelledby="main-title">
    <div class="card">
      <div style="margin-bottom:12px;display:flex;justify-content:space-between;align-items:center">
        <strong>Resume & Job Description</strong>
        <div class="small">Supports: PDF, DOCX, TXT (auto-extract)</div>
      </div>

      <div style="display:flex;flex-direction:column;gap:12px">
        <div>
          <label for="fileUpload">Upload Resume</label><br />
          <input id="fileUpload" type="file" accept=".pdf,.docx,.txt" />
        </div>

        <div>
          <label for="resumeText">Resume Text</label>
          <textarea id="resumeText" placeholder="Paste resume content..."></textarea>
        </div>

        <div>
          <label for="jobText">Job Description</label>
          <textarea id="jobText" placeholder="Paste job description here..."></textarea>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button id="analyzeBtn" class="btn">Analyze</button>
          <button id="downloadBtn" class="btn ghost">Download Report</button>
          <div style="margin-left:auto" class="small">Prefer reduced motion? Use OS setting.</div>
        </div>
      </div>
    </div>

    <aside class="card">
      <div style="display:flex;flex-direction:column;align-items:center">
        <div class="gauge" style="width:220px;height:220px;position:relative">
          <svg id="gsvg" width="220" height="220" viewBox="0 0 220 220" aria-hidden="true">
            <defs>
              <linearGradient id="grad" x1="0" x2="1"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#7c3aed"/></linearGradient>
            </defs>
            <circle cx="110" cy="110" r="96" stroke="rgba(255,255,255,0.04)" stroke-width="18" fill="none" />
            <circle id="progress" cx="110" cy="110" r="96" stroke="url(#grad)" stroke-width="18" stroke-linecap="round" fill="none"
              stroke-dasharray="603" stroke-dashoffset="603" transform="rotate(-90 110 110)"></circle>
          </svg>
          <div style="position:absolute;left:0;right:0;top:0;bottom:0;display:flex;flex-direction:column;align-items:center;justify-content:center">
            <div id="scoreNum" style="font-size:36px;font-weight:700">--</div>
            <div style="font-size:13px;color:var(--muted)">ATS Score</div>
          </div>
        </div>

        <div style="width:100%;margin-top:10px">
          <div style="display:flex;justify-content:space-between;align-items:center"><strong>Breakdown</strong><span class="small" id="matchPercent">Match: --%</span></div>
          <div class="breakdown" style="margin-top:8px">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><div style="width:120px;color:var(--muted)">Keywords</div><div class="bar"><i id="barKeywords"></i></div><div id="kwVal" style="width:36px;text-align:right;color:var(--muted)">--%</div></div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><div style="width:120px;color:var(--muted)">Headings</div><div class="bar"><i id="barHeadings"></i></div><div id="hdVal" style="width:36px;text-align:right;color:var(--muted)">--%</div></div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><div style="width:120px;color:var(--muted)">Length</div><div class="bar"><i id="barLength"></i></div><div id="lenVal" style="width:36px;text-align:right;color:var(--muted)">--%</div></div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><div style="width:120px;color:var(--muted)">Bullets</div><div class="bar"><i id="barBullets"></i></div><div id="blVal" style="width:36px;text-align:right;color:var(--muted)">--%</div></div>
          </div>

          <div id="suggestions" class="suggestions">Suggestions will appear here after analysis.</div>
        </div>
      </div>
    </aside>
  </section>
</div>

<script>
/* ---------- Particle background (kept lightweight) ---------- */
(function(){
  const canvas = document.createElement('canvas');
  canvas.id = 'bg';
  Object.assign(canvas.style, {position:'fixed',inset:0,zIndex:0,pointerEvents:'none'});
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  let w = canvas.width = innerWidth, h = canvas.height = innerHeight;
  let parts = [];
  const COUNT = Math.min(60, Math.floor((w*h)/120000));
  function rand(a,b){return Math.random()*(b-a)+a}
  function make(){ parts = []; for(let i=0;i<COUNT;i++) parts.push({x:rand(0,w),y:rand(0,h),r:rand(.8,2.2),vx:rand(-0.2,0.2),vy:rand(-0.15,0.15),a:rand(.2,.6),h:rand(170,260)}) }
  window.addEventListener('resize', ()=>{w=canvas.width=innerWidth;h=canvas.height=innerHeight;make()});
  make();
  let running = !window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  let mouse = {x:-9999,y:-9999};
  window.addEventListener('pointermove',(e)=>{mouse.x=e.clientX;mouse.y=e.clientY});
  function draw(){
    if(!running) return;
    ctx.clearRect(0,0,w,h);
    let g = ctx.createLinearGradient(0,0,w,h);
    g.addColorStop(0,'rgba(12,18,30,0.6)'); g.addColorStop(1,'rgba(3,8,18,0.4)');
    ctx.fillStyle = g; ctx.fillRect(0,0,w,h);
    for(const p of parts){
      p.x += p.vx + (mouse.x>-9000 ? (mouse.x - p.x)*0.0006 : 0);
      p.y += p.vy + (mouse.y>-9000 ? (mouse.y - p.y)*0.0006 : 0);
      if(p.x < -10) p.x = w+10; if(p.x > w+10) p.x = -10;
      if(p.y < -10) p.y = h+10; if(p.y > h+10) p.y = -10;
      ctx.beginPath(); ctx.fillStyle = `hsla(${p.h},70%,65%,${p.a})`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
    }
    requestAnimationFrame(draw);
  }
  if(running) requestAnimationFrame(draw);
})();

/* ---------- File upload & extraction ---------- */
const fileEl = document.getElementById('fileUpload');
fileEl.addEventListener('change', handleFile);

async function handleFile(e){
  const file = e.target.files && e.target.files[0];
  if(!file) return;
  const ext = file.name.split('.').pop().toLowerCase();
  const out = document.getElementById('resumeText');

  try {
    if(ext === 'txt'){
      out.value = await file.text();
      autoAnalyzeIfNotEmpty();
      return;
    }
    if(ext === 'pdf'){
      await extractPDF(file);
      autoAnalyzeIfNotEmpty();
      return;
    }
    if(ext === 'docx'){
      await extractDOCX(file);
      autoAnalyzeIfNotEmpty();
      return;
    }
    alert('Unsupported file: ' + ext);
  } catch (err){
    console.error('Extraction error', err);
    alert('Error extracting file: ' + (err && err.message ? err.message : err));
  }
}

async function extractPDF(file){
  if(!window.pdfjsLib) throw new Error('pdfjsLib not loaded');
  const reader = new FileReader();
  return new Promise((resolve,reject)=>{
    reader.onload = async function(){
      try{
        const typed = new Uint8Array(this.result);
        const pdf = await pdfjsLib.getDocument(typed).promise;
        let text = '';
        for(let p=1;p<=pdf.numPages;p++){
          const page = await pdf.getPage(p);
          const content = await page.getTextContent();
          text += content.items.map(i=>i.str).join(' ') + '\n';
        }
        document.getElementById('resumeText').value = text.trim();
        resolve();
      } catch(e){ reject(e) }
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}

function extractDOCX(file){
  if(!window.mammoth) return Promise.reject(new Error('mammoth not loaded'));
  const reader = new FileReader();
  return new Promise((resolve,reject)=>{
    reader.onload = function(ev){
      mammoth.extractRawText({arrayBuffer: ev.target.result})
        .then(res => {
          document.getElementById('resumeText').value = (res && res.value) ? res.value.trim() : '';
          resolve();
        })
        .catch(reject);
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(file);
  });
}

/* ---------- ATS analysis logic ---------- */
function sanitizeText(s){ return (s||'').replace(/\r/g,' ').replace(/\n+/g,'\n').trim(); }
function tokenizeWords(s){ return (s||'').toLowerCase().replace(/[^\w\s\-+]/g,' ').split(/\s+/).filter(Boolean); }
function extractKeywordsFromJD(jd){
  const stop = new Set(["and","or","the","a","an","to","for","of","in","on","with","by","is","are","that","this","as","at","be","from","using","use","will","must"]);
  const tokens = tokenizeWords(jd);
  const counts = {};
  for(const t of tokens){ if(t.length<=2 || stop.has(t)) continue; counts[t]=(counts[t]||0)+1 }
  return Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,30).map(x=>x[0]);
}

function analyzeResume(resumeText, jobText){
  resumeText = sanitizeText(resumeText);
  jobText = sanitizeText(jobText);
  const resumeWords = tokenizeWords(resumeText); const resumeSet = new Set(resumeWords);
  const jdKeywords = extractKeywordsFromJD(jobText||'');
  let matched = 0; jdKeywords.forEach(k=>{ if(resumeSet.has(k)) matched++ });
  const keywordScore = jdKeywords.length ? Math.round(matched / jdKeywords.length * 100) : 0;

  const headingCandidates = ["experience","work experience","professional experience","education","skills","summary","projects","certifications","contact","achievements","objective"];
  let presentCount = 0; headingCandidates.forEach(h=>{ if(new RegExp('\\b'+h.replace(/\s+/g,'\\s+')+'\\b','i').test(resumeText)) presentCount++ });
  const headingsScore = Math.round(presentCount / headingCandidates.length * 100);

  const wordCount = resumeWords.length;
  let lengthScore = 0;
  if(wordCount === 0) lengthScore = 0;
  else if(wordCount < 200) lengthScore = Math.round((wordCount / 200) * 40 + 10);
  else if(wordCount <= 900) lengthScore = 100;
  else lengthScore = Math.round(Math.max(40, 100 - ((wordCount - 900)/10)));
  lengthScore = Math.min(100, Math.max(0, lengthScore));

  const bulletsMatches = resumeText.match(/(^|\n)\s*(\-|\*|\u2022|\d+\.)\s+/g);
  const bulletsCount = bulletsMatches ? bulletsMatches.length : 0;
  const bulletsScore = Math.min(100, Math.round(Math.min(40, bulletsCount) * 2.5 + (bulletsCount>0?40:0)));

  const phoneFound = /(\+?\d{1,3}[-.\s]?)?(\d{3}[-.\s]?\d{3}[-.\s]?\d{4})/.test(resumeText);
  const emailFound = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b/.test(resumeText);
  const contactScore = (phoneFound && emailFound) ? 100 : (emailFound || phoneFound ? 60 : 0);

  const specialCharRatio = (resumeText.replace(/\s/g,'').length===0)?0: (resumeText.replace(/[A-Za-z0-9\s]/g,'').length / resumeText.replace(/\s/g,'').length);
  const formatPenalty = Math.min(20, Math.round(specialCharRatio * 100));
  const formattingScore = Math.max(40, 100 - formatPenalty);

  const weights = {keywords:0.40, headings:0.15, length:0.15, bullets:0.10, contact:0.10, formatting:0.10};
  const atsScoreRaw = keywordScore*weights.keywords + headingsScore*weights.headings + lengthScore*weights.length + bulletsScore*weights.bullets + contactScore*weights.contact + formattingScore*weights.formatting;
  const atsScore = Math.round(atsScoreRaw);

  const suggestions = [];
  if(!emailFound) suggestions.push("Add a professional email address (e.g. name@example.com).");
  if(!phoneFound) suggestions.push("Include a contact phone number.");
  if(keywordScore < 60 && jdKeywords.length) suggestions.push(`Add ${Math.max(1, Math.ceil((jdKeywords.length * 0.6) - matched))} more job-relevant keyword(s): ${jdKeywords.filter(k=>!resumeSet.has(k)).slice(0,6).join(', ')}`);
  if(headingsScore < 60) suggestions.push("Use standard headings such as: Experience, Education, Skills, Summary/Objective.");
  if(lengthScore < 50) suggestions.push("Consider adding more detail in experience bullets (achievements, metrics).");
  if(bulletsScore < 60) suggestions.push("Use bullet points for responsibilities and achievements instead of long paragraphs.");
  if(formattingScore < 60) suggestions.push("Avoid special characters, images, and complex tables — use simple text and bullets for ATS compatibility.");
  if(atsScore < 70) suggestions.unshift("Your resume is likely to have trouble passing an ATS — follow suggestions to improve your ATS score.");

  return {atsScore, keywordScore, headingsScore, lengthScore, bulletsScore, formattingScore, contactScore, wordCount, matched, jdKeywords, suggestions};
}

/* ---------- UI / gauge ---------- */
function setGauge(pct){
  const circ = 2 * Math.PI * 96;
  const circle = document.getElementById('progress');
  // ensure dasharray matches circumference
  circle.setAttribute('stroke-dasharray', String(Math.round(circ)));
  const offset = Math.round(circ * (1 - pct/100));
  circle.style.transition = 'stroke-dashoffset 900ms cubic-bezier(.2,.9,.2,1)';
  circle.style.strokeDashoffset = offset;
  document.getElementById('scoreNum').textContent = pct + '%';
}

function animateBar(id,val){ document.getElementById(id).style.width = (val) + '%'; }

function renderResults(resumeText, jobText, result){
  setGauge(result.atsScore);
  document.getElementById('matchPercent').textContent = 'Match: ' + result.keywordScore + '%';
  document.getElementById('kwVal').textContent = result.keywordScore + '%';
  document.getElementById('hdVal').textContent = result.headingsScore + '%';
  document.getElementById('lenVal').textContent = result.lengthScore + '%';
  document.getElementById('blVal').textContent = result.bulletsScore + '%';
  animateBar('barKeywords', result.keywordScore);
  animateBar('barHeadings', result.headingsScore);
  animateBar('barLength', result.lengthScore);
  animateBar('barBullets', result.bulletsScore);

  const sug = document.getElementById('suggestions');
  if(!result.suggestions || result.suggestions.length===0) sug.textContent = 'Great job — resume looks ATS-friendly!';
  else sug.innerHTML = '<strong>Top suggestions</strong><ul style="margin:8px 0 0 16px;color:var(--muted)">' + result.suggestions.map(s=>'<li>'+escapeHtml(s)+'</li>').join('') + '</ul>';
}
function escapeHtml(s){ return (s||'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ---------- interactions ---------- */
const analyzeBtn = document.getElementById('analyzeBtn');
analyzeBtn.addEventListener('click', ()=> {
  const resumeText = document.getElementById('resumeText').value.trim();
  const jobText = document.getElementById('jobText').value.trim();
  if(!resumeText || resumeText.length < 20){
    alert('Please paste resume text or upload a file that contains text (at least some content).');
    return;
  }
  analyzeBtn.disabled = true; analyzeBtn.textContent = 'Analyzing…';
  setTimeout(()=>{
    try {
      const result = analyzeResume(resumeText, jobText);
      renderResults(resumeText, jobText, result);
    } catch (err) {
      console.error(err); alert('Analysis failed: ' + (err && err.message ? err.message : err));
    } finally {
      analyzeBtn.disabled = false; analyzeBtn.textContent = 'Analyze';
    }
  }, 250);
});

document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const resumeText = document.getElementById('resumeText').value;
  if(!resumeText.trim()){ alert('Paste resume text first to generate a report.'); return; }
  const jobText = document.getElementById('jobText').value;
  const result = analyzeResume(resumeText, jobText);
  const lines = [];
  lines.push('ATS-Friendly AI Resume Analyzer — Report');
  lines.push('ATS Score: '+result.atsScore+'%');
  lines.push('Keywords matched: '+result.matched+'/'+result.jdKeywords.length);
  lines.push('Headings score: '+result.headingsScore+'%');
  lines.push('Length score: '+result.lengthScore+'% (words: '+result.wordCount+')');
  lines.push('Bullets score: '+result.bulletsScore+'%');
  lines.push('');
  lines.push('Top suggestions:');
  result.suggestions.forEach((s,i)=> lines.push((i+1)+'. '+s));
  lines.push('');
  lines.push('--- Resume (first 1000 chars) ---');
  lines.push(resumeText.substring(0,1000));
  const blob = new Blob([lines.join('\n')], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'ATS_Report.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* ---------- helpers ---------- */
function autoAnalyzeIfNotEmpty(){
  const txt = (document.getElementById('resumeText').value||'').trim();
  if(txt && txt.length > 20){
    // small delay so UI shows extracted content first
    setTimeout(()=> document.getElementById('analyzeBtn').click(), 300);
  }
}

/* ---------- demo content (optional) ---------- */
document.getElementById('resumeText').value = `John Doe
Contact: john.doe@example.com | +1 555 123 4567
Experience
- Senior Software Engineer, Acme Corp
Skills: JavaScript, Node.js, Python, AWS, SQL
Education: B.S. Computer Science`;
document.getElementById('jobText').value = `Senior Software Engineer with Node.js, AWS, Docker, SQL. Build microservices and optimize systems.`;

setTimeout(()=>document.getElementById('analyzeBtn').click(),450);
</script>
</body>
</html>
